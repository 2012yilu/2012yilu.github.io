<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>待办事项记录板</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        body {
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            min-height: 100vh;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
        }
        .nav {
            display: flex;
            justify-content: space-around;
            background-color: #2c3e50;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 10px 0;
        }
        .nav button {
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            padding: 10px 20px;
            cursor: pointer;
        }
        .nav button.active {
            background-color: #3498db;
            border-radius: 5px;
        }
        .page {
            display: none;
            padding-bottom: 60px;
        }
        .page.active {
            display: block;
        }
        .task {
            background-color: #ecf0f1;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            position: relative;
        }
        .task h3 {
            margin-top: 0;
        }
        .task p {
            margin-bottom: 5px;
        }
        .task .complete-btn {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
        }
        .task .delete-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            position: absolute;
            right: 15px;
            top: 15px;
        }
        .priority-1 { border-left: 5px solid #e74c3c; } /* 紧急且重要 */
        .priority-2 { border-left: 5px solid #f39c12; } /* 重要但不紧急 */
        .priority-3 { border-left: 5px solid #3498db; } /* 紧急但不重要 */
        .priority-4 { border-left: 5px solid #2ecc71; } /* 不紧急且不重要 */
        .priority-section {
            margin-bottom: 20px;
        }
        .priority-title {
            font-weight: bold;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #ddd;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .form-group textarea {
            height: 80px;
        }
        .radio-group, .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .radio-option, .checkbox-option {
            display: flex;
            align-items: center;
        }
        .submit-btn {
            background-color: #2c3e50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
        }
        .stats-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
        .stat-box {
            flex: 1;
            min-width: 150px;
            background-color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }
        .date-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .date-filters select {
            flex: 1;
            padding: 8px;
        }
        .no-tasks {
            text-align: center;
            color: #7f8c8d;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>待办事项记录板</h1>
        
        <!-- 待办页面 -->
        <div id="todo-page" class="page active">
            <h2>今日待办事项</h2>
            
            <div id="today-tasks">
                <!-- 今日任务将在这里动态生成 -->
            </div>
            
            <h2>任务分类</h2>
            
            <div class="priority-section">
                <div class="priority-title">紧急且重要</div>
                <div id="priority-1-tasks" class="priority-tasks">
                    <!-- 紧急且重要任务将在这里动态生成 -->
                </div>
            </div>
            
            <div class="priority-section">
                <div class="priority-title">重要但不紧急</div>
                <div id="priority-2-tasks" class="priority-tasks">
                    <!-- 重要但不紧急任务将在这里动态生成 -->
                </div>
            </div>
            
            <div class="priority-section">
                <div class="priority-title">紧急但不重要</div>
                <div id="priority-3-tasks" class="priority-tasks">
                    <!-- 紧急但不重要任务将在这里动态生成 -->
                </div>
            </div>
            
            <div class="priority-section">
                <div class="priority-title">不紧急且不重要</div>
                <div id="priority-4-tasks" class="priority-tasks">
                    <!-- 不紧急且不重要任务将在这里动态生成 -->
                </div>
            </div>
        </div>
        
        <!-- 添加页面 -->
        <div id="add-page" class="page">
            <h2>添加新任务</h2>
            
            <form id="add-task-form">
                <div class="form-group">
                    <label for="task-name">项目名称</label>
                    <input type="text" id="task-name" required>
                </div>
                
                <div class="form-group">
                    <label for="task-notes">项目备注</label>
                    <textarea id="task-notes"></textarea>
                </div>
                
                <div class="form-group">
                    <label>任务类型</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="task-type" value="once" checked> 一次性任务
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="task-type" value="recurring"> 持续性任务
                        </label>
                    </div>
                </div>
                
                <div class="form-group" id="recurring-days-container" style="display: none;">
                    <label>选择重复日期</label>
                    <div class="checkbox-group">
                        <label class="checkbox-option">
                            <input type="checkbox" name="recurring-day" value="1"> 周一
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" name="recurring-day" value="2"> 周二
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" name="recurring-day" value="3"> 周三
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" name="recurring-day" value="4"> 周四
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" name="recurring-day" value="5"> 周五
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" name="recurring-day" value="6"> 周六
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" name="recurring-day" value="0"> 周日
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="task-start-date">开始日期</label>
                    <input type="date" id="task-start-date" required>
                </div>
                
                <div class="form-group">
                    <label for="task-end-date">结束日期</label>
                    <input type="date" id="task-end-date">
                </div>
                
                <div class="form-group">
                    <label>优先级</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="priority" value="1" required> 紧急且重要
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="priority" value="2"> 重要但不紧急
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="priority" value="3"> 紧急但不重要
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="priority" value="4"> 不紧急且不重要
                        </label>
                    </div>
                </div>
                
                <button type="submit" class="submit-btn">创建任务</button>
            </form>
        </div>
        
        <!-- 历史页面 -->
        <div id="history-page" class="page">
            <h2>历史记录</h2>
            
            <div class="date-filters">
                <select id="history-month">
                    <option value="">所有月份</option>
                    <option value="1">一月</option>
                    <option value="2">二月</option>
                    <option value="3">三月</option>
                    <option value="4">四月</option>
                    <option value="5">五月</option>
                    <option value="6">六月</option>
                    <option value="7">七月</option>
                    <option value="8">八月</option>
                    <option value="9">九月</option>
                    <option value="10">十月</option>
                    <option value="11">十一月</option>
                    <option value="12">十二月</option>
                </select>
                
                <select id="history-year">
                    <option value="">所有年份</option>
                    <!-- 年份将通过JavaScript动态生成 -->
                </select>
            </div>
            
            <div id="history-tasks">
                <!-- 历史任务将在这里动态生成 -->
            </div>
        </div>
        
        <!-- 统计页面 -->
        <div id="stats-page" class="page">
            <h2>任务统计</h2>
            
            <div class="date-filters">
                <select id="stats-period">
                    <option value="week">本周</option>
                    <option value="month">本月</option>
                    <option value="year">本年</option>
                    <option value="all">全部</option>
                </select>
            </div>
            
            <div class="stats-container">
                <div class="stat-box">
                    <div>总任务数</div>
                    <div class="stat-value" id="total-tasks">0</div>
                </div>
                
                <div class="stat-box">
                    <div>已完成</div>
                    <div class="stat-value" id="completed-tasks">0</div>
                </div>
                
                <div class="stat-box">
                    <div>完成率</div>
                    <div class="stat-value" id="completion-rate">0%</div>
                </div>
            </div>
            
            <h3>优先级分布</h3>
            <div class="stats-container">
                <div class="stat-box">
                    <div>紧急且重要</div>
                    <div class="stat-value" id="priority-1-count">0</div>
                </div>
                
                <div class="stat-box">
                    <div>重要但不紧急</div>
                    <div class="stat-value" id="priority-2-count">0</div>
                </div>
                
                <div class="stat-box">
                    <div>紧急但不重要</div>
                    <div class="stat-value" id="priority-3-count">0</div>
                </div>
                
                <div class="stat-box">
                    <div>不紧急且不重要</div>
                    <div class="stat-value" id="priority-4-count">0</div>
                </div>
            </div>
        </div>
        
        <!-- 导航栏 -->
        <div class="nav">
            <button id="todo-btn" class="active">待办</button>
            <button id="add-btn">添加</button>
            <button id="history-btn">历史</button>
            <button id="stats-btn">统计</button>
        </div>
    </div>

    <script>
        // 页面切换逻辑
        document.getElementById('todo-btn').addEventListener('click', function() {
            switchPage('todo');
        });
        
        document.getElementById('add-btn').addEventListener('click', function() {
            switchPage('add');
        });
        
        document.getElementById('history-btn').addEventListener('click', function() {
            switchPage('history');
            loadHistoryTasks();
        });
        
        document.getElementById('stats-btn').addEventListener('click', function() {
            switchPage('stats');
            updateStats();
        });
        
        function switchPage(page) {
            // 隐藏所有页面
            document.querySelectorAll('.page').forEach(p => {
                p.classList.remove('active');
            });
            
            // 移除所有导航按钮的active类
            document.querySelectorAll('.nav button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // 显示选中的页面
            document.getElementById(page + '-page').classList.add('active');
            document.getElementById(page + '-btn').classList.add('active');
        }
        
        // 任务类型切换显示重复日期选项
        document.querySelectorAll('input[name="task-type"]').forEach(radio => {
            radio.addEventListener('change', function() {
                document.getElementById('recurring-days-container').style.display = 
                    this.value === 'recurring' ? 'block' : 'none';
            });
        });
        
        // 初始化日期输入
        document.getElementById('task-start-date').valueAsDate = new Date();
        
        // 任务管理
        let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
        let completedTasks = JSON.parse(localStorage.getItem('completedTasks')) || [];
        
        // 添加任务表单提交
        document.getElementById('add-task-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('task-name').value;
            const notes = document.getElementById('task-notes').value;
            const taskType = document.querySelector('input[name="task-type"]:checked').value;
            const startDate = document.getElementById('task-start-date').value;
            const endDate = document.getElementById('task-end-date').value || null;
            const priority = document.querySelector('input[name="priority"]:checked').value;
            
            let recurringDays = [];
            if (taskType === 'recurring') {
                document.querySelectorAll('input[name="recurring-day"]:checked').forEach(day => {
                    recurringDays.push(parseInt(day.value));
                });
            }
            
            const newTask = {
                id: Date.now(),
                name,
                notes,
                type: taskType,
                startDate,
                endDate,
                priority: parseInt(priority),
                recurringDays,
                completed: false,
                createdAt: new Date().toISOString()
            };
            
            tasks.push(newTask);
            saveTasks();
            
            // 重置表单
            this.reset();
            document.getElementById('task-start-date').valueAsDate = new Date();
            document.getElementById('recurring-days-container').style.display = 'none';
            
            // 显示成功消息
            alert('任务添加成功！');
            
            // 刷新待办列表
            loadTodayTasks();
        });
        
        // 保存任务到本地存储
        function saveTasks() {
            localStorage.setItem('tasks', JSON.stringify(tasks));
            localStorage.setItem('completedTasks', JSON.stringify(completedTasks));
        }
        
        // 加载今日任务
        function loadTodayTasks() {
            const today = new Date();
            const todayStr = formatDate(today);
            const dayOfWeek = today.getDay(); // 0是周日，6是周六
            
            const todayTasksContainer = document.getElementById('today-tasks');
            todayTasksContainer.innerHTML = '';
            
            const priorityContainers = {
                1: document.getElementById('priority-1-tasks'),
                2: document.getElementById('priority-2-tasks'),
                3: document.getElementById('priority-3-tasks'),
                4: document.getElementById('priority-4-tasks')
            };
            
            // 清空优先级容器
            Object.values(priorityContainers).forEach(container => {
                container.innerHTML = '';
            });
            
            // 筛选今天的任务
            const todayTasks = tasks.filter(task => {
                // 检查任务是否在有效期内
                if (task.endDate && new Date(task.endDate) < today) {
                    return false;
                }
                
                if (new Date(task.startDate) > today) {
                    return false;
                }
                
                // 一次性任务
                if (task.type === 'once') {
                    return formatDate(new Date(task.startDate)) === todayStr && !task.completed;
                }
                
                // 持续性任务
                if (task.type === 'recurring') {
                    // 检查今天是否是选中的重复日
                    return task.recurringDays.includes(dayOfWeek) && !task.completed;
                }
                
                return false;
            });
            
            if (todayTasks.length === 0) {
                todayTasksContainer.innerHTML = '<div class="no-tasks">今日没有待办事项</div>';
            } else {
                todayTasks.forEach(task => {
                    const taskElement = createTaskElement(task, true);
                    todayTasksContainer.appendChild(taskElement);
                });
            }
            
            // 按优先级分类显示所有未完成任务
            tasks.filter(task => !task.completed).forEach(task => {
                const priority = task.priority;
                const taskElement = createTaskElement(task, false);
                priorityContainers[priority].appendChild(taskElement);
            });
            
            // 检查是否有空优先级容器
            Object.entries(priorityContainers).forEach(([priority, container]) => {
                if (container.children.length === 0) {
                    container.innerHTML = '<div class="no-tasks">暂无任务</div>';
                }
            });
        }
        
        // 创建任务元素
        function createTaskElement(task, showCompleteButton) {
            const taskElement = document.createElement('div');
            taskElement.className = `task priority-${task.priority}`;
            taskElement.dataset.id = task.id;
            
            let html = `
                <h3>${task.name}</h3>
                ${task.notes ? `<p>${task.notes}</p>` : ''}
                <p>优先级: ${getPriorityName(task.priority)}</p>
                <p>开始日期: ${formatDisplayDate(task.startDate)}</p>
            `;
            
            if (task.endDate) {
                html += `<p>结束日期: ${formatDisplayDate(task.endDate)}</p>`;
            }
            
            if (task.type === 'recurring') {
                const days = ['周日', '周一', '周二', '周三', '周四', '周五', '周六'];
                const recurringDaysStr = task.recurringDays.map(day => days[day]).join(', ');
                html += `<p>重复日期: ${recurringDaysStr}</p>`;
            }
            
            if (showCompleteButton) {
                html += `<button class="complete-btn" data-id="${task.id}">完成</button>`;
            }
            
            taskElement.innerHTML = html;
            
            if (showCompleteButton) {
                taskElement.querySelector('.complete-btn').addEventListener('click', function() {
                    completeTask(task.id);
                });
            }
            
            return taskElement;
        }
        
        // 完成任务
        function completeTask(taskId) {
            const taskIndex = tasks.findIndex(task => task.id === taskId);
            
            if (taskIndex !== -1) {
                const task = tasks[taskIndex];
                const completedTask = {
                    ...task,
                    completed: true,
                    completedAt: new Date().toISOString()
                };
                
                // 如果是持续性任务，不标记为已完成，而是记录完成历史
                if (task.type === 'recurring') {
                    completedTasks.push(completedTask);
                } else {
                    // 一次性任务，标记为已完成并从任务列表中移除
                    tasks.splice(taskIndex, 1);
                    completedTasks.push(completedTask);
                }
                
                saveTasks();
                loadTodayTasks();
            }
        }
        
        // 加载历史任务
        function loadHistoryTasks() {
            const historyContainer = document.getElementById('history-tasks');
            historyContainer.innerHTML = '';
            
            const monthFilter = document.getElementById('history-month').value;
            const yearFilter = document.getElementById('history-year').value;
            
            let filteredTasks = [...completedTasks];
            
            if (monthFilter || yearFilter) {
                filteredTasks = filteredTasks.filter(task => {
                    const date = new Date(task.completedAt || task.createdAt);
                    const taskMonth = date.getMonth() + 1;
                    const taskYear = date.getFullYear();
                    
                    return (
                        (!monthFilter || taskMonth.toString() === monthFilter) &&
                        (!yearFilter || taskYear.toString() === yearFilter)
                    );
                });
            }
            
            if (filteredTasks.length === 0) {
                historyContainer.innerHTML = '<div class="no-tasks">没有历史记录</div>';
                return;
            }
            
            // 按日期排序
            filteredTasks.sort((a, b) => {
                const dateA = new Date(a.completedAt || a.createdAt);
                const dateB = new Date(b.completedAt || b.createdAt);
                return dateB - dateA;
            });
            
            // 按日期分组
            const tasksByDate = {};
            filteredTasks.forEach(task => {
                const date = new Date(task.completedAt || task.createdAt);
                const dateStr = formatDisplayDate(date);
                
                if (!tasksByDate[dateStr]) {
                    tasksByDate[dateStr] = [];
                }
                
                tasksByDate[dateStr].push(task);
            });
            
            // 显示分组后的任务
            for (const [date, dateTasks] of Object.entries(tasksByDate)) {
                const dateHeader = document.createElement('h3');
                dateHeader.textContent = date;
                historyContainer.appendChild(dateHeader);
                
                dateTasks.forEach(task => {
                    const taskElement = document.createElement('div');
                    taskElement.className = `task priority-${task.priority}`;
                    
                    let html = `
                        <h3>${task.name}</h3>
                        ${task.notes ? `<p>${task.notes}</p>` : ''}
                        <p>优先级: ${getPriorityName(task.priority)}</p>
                        <p>完成时间: ${formatDisplayDateTime(new Date(task.completedAt || task.createdAt))}</p>
                        <button class="delete-btn" data-id="${task.id}">删除</button>
                    `;
                    
                    taskElement.innerHTML = html;
                    historyContainer.appendChild(taskElement);
                    
                    // 添加删除按钮事件
                    taskElement.querySelector('.delete-btn').addEventListener('click', function() {
                        deleteHistoryTask(task.id);
                    });
                });
            }
        }
        
        // 删除历史任务
        function deleteHistoryTask(taskId) {
            if (confirm('确定要删除此任务记录吗？')) {
                const index = completedTasks.findIndex(task => task.id === taskId);
                if (index !== -1) {
                    completedTasks.splice(index, 1);
                    saveTasks();
                    loadHistoryTasks();
                }
            }
        }
        
        // 更新统计信息
        function updateStats() {
            const period = document.getElementById('stats-period').value;
            const now = new Date();
            let startDate, endDate;
            
            switch (period) {
                case 'week':
                    // 本周开始（周一）
                    const dayOfWeek = now.getDay() || 7; // 0是周日，转换为7
                    startDate = new Date(now);
                    startDate.setDate(now.getDate() - dayOfWeek + 1);
                    startDate.setHours(0, 0, 0, 0);
                    endDate = new Date(now);
                    endDate.setHours(23, 59, 59, 999);
                    break;
                case 'month':
                    // 本月开始
                    startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                    endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0, 23, 59, 59, 999);
                    break;
                case 'year':
                    // 本年开始
                    startDate = new Date(now.getFullYear(), 0, 1);
                    endDate = new Date(now.getFullYear(), 11, 31, 23, 59, 59, 999);
                    break;
                default: // all
                    startDate = new Date(0);
                    endDate = new Date();
                    break;
            }
            
            // 筛选任务
            const filteredTasks = completedTasks.filter(task => {
                const taskDate = new Date(task.completedAt || task.createdAt);
                return taskDate >= startDate && taskDate <= endDate;
            });
            
            const totalTasks = filteredTasks.length;
            
            // 按优先级统计
            const priorityCounts = [0, 0, 0, 0];
            filteredTasks.forEach(task => {
                priorityCounts[task.priority - 1]++;
            });
            
            // 更新UI
            document.getElementById('total-tasks').textContent = totalTasks;
            document.getElementById('completed-tasks').textContent = totalTasks;
            document.getElementById('completion-rate').textContent = '100%';
            
            document.getElementById('priority-1-count').textContent = priorityCounts[0];
            document.getElementById('priority-2-count').textContent = priorityCounts[1];
            document.getElementById('priority-3-count').textContent = priorityCounts[2];
            document.getElementById('priority-4-count').textContent = priorityCounts[3];
        }
        
        // 辅助函数
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        function formatDisplayDate(dateStr) {
            const date = new Date(dateStr);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}年${month}月${day}日`;
        }
        
        function formatDisplayDateTime(date) {
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${formatDisplayDate(date)} ${hours}:${minutes}`;
        }
        
        function getPriorityName(priority) {
            const names = {
                1: '紧急且重要',
                2: '重要但不紧急',
                3: '紧急但不重要',
                4: '不紧急且不重要'
            };
            return names[priority] || '未知';
        }
        
        // 初始化年份选择器
        function initYearSelector() {
            const yearSelect = document.getElementById('history-year');
            const currentYear = new Date().getFullYear();
            
            for (let year = currentYear; year >= currentYear - 10; year--) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearSelect.appendChild(option);
            }
        }
        
        // 初始化事件监听器
        document.getElementById('history-month').addEventListener('change', loadHistoryTasks);
        document.getElementById('history-year').addEventListener('change', loadHistoryTasks);
        document.getElementById('stats-period').addEventListener('change', updateStats);
        
        // 初始化应用
        initYearSelector();
        loadTodayTasks();
    </script>
</body>
</html>
